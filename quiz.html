<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="assets/favicon.png" />
  <title>Tyler Yates | Synergy Check</title>
  <meta name="description" content="Engineering Planner @ Lockheed Martin | Software Roots | Future Director of Tech." />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Outfit:wght@500;600;700;800&display=swap"
    rel="stylesheet"
  />

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            heading: ["Outfit", "sans-serif"],
            body: ["Inter", "sans-serif"]
          },
          colors: {
            makerSky: "#0ea5e9",
            makerViolet: "#8b5cf6",
            makerSkyText: "#0369a1",
            makerVioletText: "#6d28d9",
            makerAmber: "#f59e0b",
            makerPaper: "#fafafa"
          },
          boxShadow: {
            glowSky: "0 20px 40px -24px rgba(14,165,233,0.7)"
          },
          keyframes: {
            floatBlob: {
              "0%, 100%": { transform: "translateY(0px) translateX(0px)" },
              "50%": { transform: "translateY(-14px) translateX(6px)" }
            }
          },
          animation: {
            blobSlow: "floatBlob 18s ease-in-out infinite",
            blobMid: "floatBlob 14s ease-in-out infinite",
            blobFast: "floatBlob 11s ease-in-out infinite"
          }
        }
      }
    };
  </script>
  <style>
    :root {
      --orbital-sky: #0ea5e9;
      --orbital-violet: #8b5cf6;
      --orbital-amber: #f59e0b;
      --orbital-gradient: linear-gradient(
        to right,
        var(--orbital-sky),
        var(--orbital-violet),
        var(--orbital-amber),
        var(--orbital-sky)
      );
      --legacy-doodle-filter: grayscale(10%) saturate(120%);
      --assembly-ease: cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes orbital-flow {
      0% { background-position: 0% 50%; }
      100% { background-position: 200% 50%; }
    }

    .animate-orbital {
      background: var(--orbital-gradient);
      background-size: 200% auto;
      animation: orbital-flow 6s linear infinite;
    }

    .legacy-doodle {
      filter: var(--legacy-doodle-filter);
    }

    .assembly-hidden {
      opacity: 0;
      transform: scale(0.9);
    }

    .assembly-reveal {
      opacity: 1;
      transform: scale(1);
    }

    .assembly-transition {
      transition-property: opacity, transform, box-shadow;
      transition-duration: 620ms;
      transition-timing-function: var(--assembly-ease);
    }

    .progress-grow {
      transition: width 800ms var(--assembly-ease);
    }

    .lift-pop {
      box-shadow:
        0 28px 52px -30px rgba(14, 165, 233, 0.82),
        0 14px 24px -18px rgba(15, 23, 42, 0.4);
      transform: scale(1.02) translateY(-2px);
    }

    .assembly-blob {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 8rem;
      height: 8rem;
      border-radius: 9999px;
      opacity: 0.88;
      filter: blur(10px);
      transform: translate(-50%, -50%) scale(0.18);
      transition:
        transform 1200ms var(--assembly-ease),
        width 1200ms var(--assembly-ease),
        height 1200ms var(--assembly-ease),
        filter 1200ms var(--assembly-ease),
        opacity 1200ms var(--assembly-ease);
      will-change: transform, width, height, filter, opacity;
    }

    #blob-layer.is-split #blob-sky {
      width: 28rem;
      height: 28rem;
      filter: blur(54px);
      opacity: 1;
      transform: translate(-44vw, -44vh) scale(1);
    }

    #blob-layer.is-split #blob-violet {
      width: 32rem;
      height: 32rem;
      filter: blur(54px);
      opacity: 1;
      transform: translate(37vw, -12vh) scale(1);
    }

    #blob-layer.is-split #blob-amber {
      width: 24rem;
      height: 24rem;
      filter: blur(50px);
      opacity: 1;
      transform: translate(-8vw, 38vh) scale(1);
    }

    .skip-link {
      position: absolute;
      left: 1rem;
      top: 1rem;
      z-index: 100;
      transform: translateY(-200%);
      border-radius: 0.75rem;
      background-color: #ffffff;
      padding: 0.6rem 1rem;
      font-size: 0.875rem;
      font-weight: 600;
      color: #0f172a;
      box-shadow: 0 10px 24px -14px rgba(15, 23, 42, 0.5);
    }

    .skip-link:focus {
      transform: translateY(0);
    }

    @media (prefers-reduced-motion: reduce) {
      .animate-orbital,
      .animate-blobSlow,
      .animate-blobMid,
      .animate-blobFast {
        animation: none !important;
      }

      .assembly-transition,
      .progress-grow,
      .assembly-blob,
      #sync-status,
      #results {
        transition-duration: 0ms !important;
      }
    }
  </style>
</head>
<body class="relative min-h-screen overflow-x-hidden bg-makerPaper font-body font-normal text-slate-900 antialiased">
  <a href="#quiz-container" class="skip-link focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-makerSky focus-visible:ring-offset-2 focus-visible:ring-offset-white">
    Skip to Content
  </a>
  <div id="blob-layer" aria-hidden="true" class="pointer-events-none absolute inset-0 z-0">
    <div id="blob-sky" class="assembly-blob animate-blobSlow bg-sky-200/40"></div>
    <div id="blob-violet" class="assembly-blob animate-blobMid bg-violet-200/40"></div>
    <div id="blob-amber" class="assembly-blob animate-blobFast bg-amber-200/40"></div>
  </div>

  <div id="legacy-layer" aria-hidden="true" class="pointer-events-none fixed inset-0 z-[1] overflow-hidden">
    <img src="assets/drawing-dragon.png" alt="" aria-hidden="true" class="legacy-doodle absolute left-[5%] top-[4%] w-[32vw] min-w-[220px] max-w-[420px] -rotate-6 opacity-[0.11]" loading="lazy" decoding="async" width="543" height="484" />
    <img src="assets/drawing-dino.png" alt="" aria-hidden="true" class="legacy-doodle absolute right-[4%] top-[20%] w-[24vw] min-w-[170px] max-w-[320px] rotate-6 opacity-[0.1]" loading="lazy" decoding="async" width="420" height="427" />
    <img src="assets/drawing-cat.png" alt="" aria-hidden="true" class="legacy-doodle absolute left-[8%] w-[24vw] min-w-[170px] max-w-[300px] rotate-3 opacity-[0.12]" style="bottom: calc(5%);" loading="lazy" decoding="async" width="381" height="507" />
    <img src="assets/drawing-sun.png" alt="" aria-hidden="true" class="legacy-doodle absolute bottom-[8%] right-[8%] w-[20vw] min-w-[150px] max-w-[250px] -rotate-3 opacity-[0.11]" loading="lazy" decoding="async" width="557" height="564" />
  </div>

  <main id="quiz-container" tabindex="-1" inert class="relative z-10 mx-auto max-w-3xl px-5 pb-16 pt-12 assembly-hidden assembly-transition md:px-10 md:pt-16">
    <section class="level-up rounded-3xl border border-white/70 bg-white/70 p-7 shadow-xl backdrop-blur-xl md:p-10">
      <header id="hero-block" class="assembly-hidden assembly-transition">
        <p class="text-xs font-bold uppercase tracking-[0.15em] text-makerVioletText">Compatibility Quest</p>
        <h1 class="mt-3 font-heading text-3xl font-extrabold leading-tight text-slate-900 md:text-5xl">
          The Best Friend Synergy Check
        </h1>
        <p class="mt-4 max-w-2xl text-sm leading-relaxed text-slate-600 md:text-base">
          A maker-themed DISC assessment to see how your collaboration style pairs with Tyler's operating mode.
        </p>
      </header>

      <div id="progress-shell" class="mt-7 assembly-hidden assembly-transition">
        <div class="flex items-center justify-between text-[11px] font-semibold uppercase tracking-wide text-slate-500">
          <span id="progress-label">Question 1 of 10</span>
          <span id="progress-value">10%</span>
        </div>
        <div class="mt-2 h-2.5 overflow-hidden rounded-full bg-slate-200/80">
          <div id="progress-bar" class="h-full w-[10%] rounded-full bg-gradient-to-r from-cyan-500 via-sky-500 to-violet-500 progress-grow"></div>
        </div>
      </div>

      <form id="quiz-form" class="mt-8 space-y-6" aria-label="The Best Friend Synergy Check">
        <div class="rounded-2xl p-[1.5px] animate-orbital shadow-glowSky">
          <div id="question-card" class="rounded-2xl border border-white/70 bg-white/75 p-6 shadow-glowSky backdrop-blur-md assembly-hidden assembly-transition">
            <p class="text-xs font-bold uppercase tracking-[0.15em] text-makerSkyText">Maker Prompt</p>
            <h2 id="question-text" class="mt-3 font-heading text-2xl font-bold text-slate-900"></h2>
            <div id="answers" class="mt-5 space-y-3"></div>
          </div>
        </div>

        <div class="flex items-center justify-between gap-3">
          <button
            type="button"
            id="prev-btn"
            class="rounded-2xl border border-slate-200 bg-white/90 px-4 py-2.5 text-sm font-semibold text-slate-700 transition-all duration-300 ease-out hover:-translate-y-0.5 hover:shadow-lg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-makerSky focus-visible:ring-offset-2 focus-visible:ring-offset-white disabled:cursor-not-allowed disabled:opacity-40"
          >
            Previous
          </button>
          <button
            type="button"
            id="next-btn"
            class="rounded-2xl bg-gradient-to-r from-cyan-500 to-violet-500 px-5 py-2.5 font-heading text-sm font-bold text-white shadow-lg shadow-violet-200 transition-all duration-300 ease-out hover:-translate-y-0.5 hover:brightness-105 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-makerSky focus-visible:ring-offset-2 focus-visible:ring-offset-white"
          >
            Next Prompt
          </button>
        </div>
      </form>
      <div id="sync-status" class="mt-4 hidden rounded-xl border border-violet-200 bg-white/85 px-4 py-3 text-center text-xs font-bold uppercase tracking-[0.15em] text-makerVioletText opacity-0 transition-opacity duration-300">
        Syncing Operating Modes...
      </div>

      <section id="results" class="mt-8 hidden rounded-2xl border border-white/70 bg-white/75 p-6 shadow-xl backdrop-blur-md transition-all duration-500 ease-out">
        <p class="text-xs font-bold uppercase tracking-[0.15em] text-makerAmber">Result Screen</p>
        <h2 id="results-heading" tabindex="-1" class="mt-2 font-heading text-3xl font-bold text-slate-900">Synergy Report</h2>

        <div class="mt-5 grid gap-4 md:grid-cols-2">
          <article class="rounded-2xl border border-sky-100 bg-sky-50/70 p-4">
            <p class="text-xs font-bold uppercase tracking-wide text-makerSkyText">Compatibility Percentage</p>
            <p id="compatibility" class="mt-2 font-heading text-4xl font-extrabold text-slate-900">0%</p>
          </article>
          <article class="rounded-2xl border border-violet-100 bg-violet-50/70 p-4">
            <p class="text-xs font-bold uppercase tracking-wide text-makerVioletText">Party Role</p>
            <p id="party-role" class="mt-2 font-heading text-2xl font-bold text-slate-900">-</p>
          </article>
        </div>

        <p id="role-detail" class="mt-5 text-sm leading-relaxed text-slate-600"></p>

        <div id="disc-bars" class="mt-6 space-y-3"></div>

        <button
          type="button"
          id="retake-btn"
          class="mt-6 rounded-2xl border border-slate-200 bg-white/90 px-4 py-2.5 text-sm font-semibold text-slate-700 transition-all duration-300 ease-out hover:-translate-y-0.5 hover:shadow-lg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-makerSky focus-visible:ring-offset-2 focus-visible:ring-offset-white"
        >
          Retake Check
        </button>
      </section>

      <a
        href="index.html"
        class="mt-8 inline-flex rounded-2xl border border-slate-200 bg-white/90 px-4 py-2.5 text-sm font-semibold text-slate-700 transition-all duration-300 ease-out hover:-translate-y-0.5 hover:shadow-lg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-makerSky focus-visible:ring-offset-2 focus-visible:ring-offset-white"
      >
        Back to Mission Control
      </a>
    </section>
  </main>

  <script>
    (() => {
      "use strict";

      // Quiz content model used by the renderer.
      const QUESTIONS = [
        {
          prompt: "A 3D print fails at 90%. Your first move?",
          options: [
            { text: "Restart immediately with a better plan.", trait: "D" },
            { text: "Laugh, post the fail, and ask for tips.", trait: "I" },
            { text: "Try to save it and keep the build steady.", trait: "S" },
            { text: "Analyze the G-code to find the error.", trait: "C" }
          ]
        },
        {
          prompt: "You just arrived at Universal. Which ride first?",
          options: [
            { text: "VelociCoaster—straight to the thrills.", trait: "D" },
            { text: "Hagrid's—fun vibes with the group.", trait: "I" },
            { text: "E.T. Adventure—keep it classic and steady.", trait: "S" },
            { text: "Bourne Stuntacular—checking the tech.", trait: "C" }
          ]
        },
        {
          prompt: "Your D&D party hits a locked door. You:",
          options: [
            { text: "Kick it down and lead the charge.", trait: "D" },
            { text: "Try to talk the guard into opening it.", trait: "I" },
            { text: "Wait for the group to decide together.", trait: "S" },
            { text: "Search for a hidden mechanism or key.", trait: "C" }
          ]
        },
        {
          prompt: "A project deadline is tomorrow. You:",
          options: [
            { text: "Cut the noise and drive to the finish.", trait: "D" },
            { text: "Get the team hyped for a final push.", trait: "I" },
            { text: "Check in to see who needs help.", trait: "S" },
            { text: "Double-check the data for any gaps.", trait: "C" }
          ]
        },
        {
          prompt: "Designing a new Disney attraction. Focus on:",
          options: [
            { text: "High-speed thrills and impact.", trait: "D" },
            { text: "Immersive story and guest joy.", trait: "I" },
            { text: "Reliable systems and safety.", trait: "S" },
            { text: "Complex engineering and precision.", trait: "C" }
          ]
        },
        {
          prompt: "Surprise holiday! Work is officially off. You:",
          options: [
            { text: "Head out for an intense hike.", trait: "D" },
            { text: "Hit the beach with a group of friends.", trait: "I" },
            { text: "Catch a movie and actually relax.", trait: "S" },
            { text: "Grind some games or optimize your PC.", trait: "C" }
          ]
        },
        {
          prompt: "A teammate misses a deadline. Your style:",
          options: [
            { text: "Assign a new owner and move on.", trait: "D" },
            { text: "Talk it out and keep things positive.", trait: "I" },
            { text: "Offer support to help them catch up.", trait: "S" },
            { text: "Update the process to prevent it next time.", trait: "C" }
          ]
        },
        {
          prompt: "Your home workspace vibe is:",
          options: [
            { text: "Mission-ready and efficient.", trait: "D" },
            { text: "Creative and full of inspiration.", trait: "I" },
            { text: "Comfortable and very consistent.", trait: "S" },
            { text: "Organized and perfectly optimized.", trait: "C" }
          ]
        },
        {
          prompt: "When combat starts in D&D, you are the:",
          options: [
            { text: "Front-line Fighter calling the shots.", trait: "D" },
            { text: "Bard keeping the energy high.", trait: "I" },
            { text: "Cleric making sure everyone is safe.", trait: "S" },
            { text: "Wizard tracking every spell and slot.", trait: "C" }
          ]
        },
        {
          prompt: "Success is best when:",
          options: [
            { text: "The mission is 100% complete.", trait: "D" },
            { text: "The whole team is celebrating.", trait: "I" },
            { text: "The progress was smooth and steady.", trait: "S" },
            { text: "The system worked perfectly.", trait: "C" }
          ]
        }
      ];

      // Scoring, rendering, and telemetry constants.
      const TYLER_PROFILE = { D: 0.36, I: 0.2, S: 0.08, C: 0.36 };
      const TRAIT_LABELS = { D: "Dominance", I: "Influence", S: "Steadiness", C: "Conscientiousness" };
      const TRAIT_COLORS = { D: "bg-makerAmber", I: "bg-makerViolet", S: "bg-sky-400", C: "bg-makerSky" };
      const TELEMETRY_ENDPOINT = "https://formspree.io/f/xnjbjrey";
      const QUIZ_ATTEMPT_KEY = "synergy_quiz_attempt_count";
      const TELEMETRY_TIMEOUT_MS = 2500;

      // Static DOM references used across quiz modules.
      const progressLabel = document.getElementById("progress-label");
      const progressValue = document.getElementById("progress-value");
      const progressBar = document.getElementById("progress-bar");
      const progressShell = document.getElementById("progress-shell");
      const quizContainer = document.getElementById("quiz-container");
      const blobLayer = document.getElementById("blob-layer");
      const heroBlock = document.getElementById("hero-block");
      const questionCard = document.getElementById("question-card");
      const questionText = document.getElementById("question-text");
      const answersWrap = document.getElementById("answers");
      const prevBtn = document.getElementById("prev-btn");
      const nextBtn = document.getElementById("next-btn");
      const quizForm = document.getElementById("quiz-form");
      const syncStatus = document.getElementById("sync-status");
      const results = document.getElementById("results");
      const compatibilityEl = document.getElementById("compatibility");
      const roleEl = document.getElementById("party-role");
      const roleDetailEl = document.getElementById("role-detail");
      const discBars = document.getElementById("disc-bars");
      const resultsHeading = document.getElementById("results-heading");
      const retakeBtn = document.getElementById("retake-btn");

      // Runtime state.
      const prefersReducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
      const SCAN_DURATION_MS = prefersReducedMotion ? 0 : 600;
      const RESULT_SYNC_MS = prefersReducedMotion ? 0 : 1500;
      const state = {
        current: 0,
        answers: new Array(QUESTIONS.length).fill(null),
        transitionBusy: false
      };

      /**
       * Validate essential DOM dependencies for quiz execution.
       * @returns {boolean}
       */
      function hasRequiredDom() {
        return [
          progressLabel,
          progressValue,
          progressBar,
          progressShell,
          quizContainer,
          blobLayer,
          heroBlock,
          questionCard,
          questionText,
          answersWrap,
          prevBtn,
          nextBtn,
          quizForm,
          syncStatus,
          results,
          compatibilityEl,
          roleEl,
          roleDetailEl,
          discBars,
          resultsHeading,
          retakeBtn
        ].every(Boolean);
      }

      /**
       * Focus the selected option, or first option, for the current question.
       * @returns {void}
       */
      function focusCurrentQuestionOption() {
        const selected = document.querySelector(`input[name="q-${state.current}"]:checked`);
        const firstOption = document.querySelector(`input[name="q-${state.current}"]`);
        const target = selected || firstOption;
        if (target) {
          target.focus();
        }
      }

      /**
       * Move focus to the results heading for screen reader context.
       * @returns {void}
       */
      function focusResultsSummary() {
        resultsHeading.focus();
      }

      /**
       * Persist and increment quiz attempt count in local storage.
       * @returns {number} Updated attempt count.
       */
      function incrementQuizAttemptCount() {
        try {
          const rawCount = localStorage.getItem(QUIZ_ATTEMPT_KEY);
          const currentCount = Number.parseInt(rawCount || "0", 10);
          const nextCount = Number.isNaN(currentCount) ? 1 : currentCount + 1;
          localStorage.setItem(QUIZ_ATTEMPT_KEY, String(nextCount));
          return nextCount;
        } catch (_error) {
          return 1;
        }
      }

      /**
       * Send JSON payload with timeout and optional silent failure handling.
       * @param {string} url - Destination endpoint.
       * @param {Record<string, unknown>} payload - JSON body content.
       * @param {{ timeoutMs?: number, silent?: boolean }} [options] - Request options.
       * @returns {Promise<Response | null>}
       */
      async function postJson(url, payload, { timeoutMs = TELEMETRY_TIMEOUT_MS, silent = false } = {}) {
        const controller = new AbortController();
        const timeoutId = window.setTimeout(() => controller.abort(), timeoutMs);

        try {
          const response = await fetch(url, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Accept: "application/json"
            },
            body: JSON.stringify(payload),
            signal: controller.signal
          });

          if (!response.ok) {
            throw new Error(`Request failed with status ${response.status}`);
          }

          return response;
        } catch (error) {
          if (silent) {
            return null;
          }
          throw error;
        } finally {
          window.clearTimeout(timeoutId);
        }
      }

      /**
       * Build telemetry payload for quiz completion.
       * @param {{ compatibility: number, role: string }} resultSummary - Computed quiz summary.
       * @param {number} attemptCount - Incremented local attempt count.
       * @returns {{ timestamp: string, attemptCount: number, compatibilityPercentage: number, partyRole: string }}
       */
      function buildTelemetryPayload(resultSummary, attemptCount) {
        return {
          timestamp: new Date().toISOString(),
          attemptCount,
          compatibilityPercentage: resultSummary.compatibility,
          partyRole: resultSummary.role
        };
      }

      /**
       * Transmit telemetry in fire-and-forget mode (silent on failure).
       * @param {{ compatibility: number, role: string }} resultSummary - Computed quiz summary.
       * @param {number} attemptCount - Incremented local attempt count.
       * @returns {Promise<void>}
       */
      async function transmitQuizTelemetry(resultSummary, attemptCount) {
        const payload = buildTelemetryPayload(resultSummary, attemptCount);
        await postJson(TELEMETRY_ENDPOINT, payload, { silent: true });
      }

      /**
       * Trigger initial assembly animation sequence for page entry.
       * @returns {void}
       */
      function runSystemBoot() {
        progressBar.style.width = "0%";
        quizContainer.removeAttribute("inert");
        blobLayer.classList.add("is-split");

        const firstQuestionPct = `${Math.round(((state.current + 1) / QUESTIONS.length) * 100)}%`;

        if (prefersReducedMotion) {
          quizContainer.classList.remove("assembly-hidden");
          quizContainer.classList.add("assembly-reveal");
          heroBlock.classList.remove("assembly-hidden");
          heroBlock.classList.add("assembly-reveal");
          progressShell.classList.remove("assembly-hidden");
          progressShell.classList.add("assembly-reveal");
          progressBar.style.width = firstQuestionPct;
          questionCard.classList.remove("assembly-hidden");
          questionCard.classList.add("assembly-reveal");
          return;
        }

        window.setTimeout(() => {
          quizContainer.classList.remove("assembly-hidden");
          quizContainer.classList.add("assembly-reveal");
          heroBlock.classList.remove("assembly-hidden");
          heroBlock.classList.add("assembly-reveal");
        }, 200);

        window.setTimeout(() => {
          progressShell.classList.remove("assembly-hidden");
          progressShell.classList.add("assembly-reveal");
          progressBar.style.width = firstQuestionPct;
        }, 400);

        window.setTimeout(() => {
          questionCard.classList.remove("assembly-hidden");
          questionCard.classList.add("assembly-reveal", "lift-pop");
        }, 600);

        window.setTimeout(() => {
          questionCard.classList.remove("lift-pop");
        }, 860);
      }

      /**
       * Render a question and update progress UI.
       * @param {number} [questionIndex=state.current] - Question index to render.
       * @returns {void}
       */
      function renderQuestion(questionIndex = state.current) {
        const question = QUESTIONS[questionIndex];
        if (!question) {
          return;
        }

        state.current = questionIndex;
        questionText.textContent = question.prompt;

        const pct = Math.round(((state.current + 1) / QUESTIONS.length) * 100);
        progressLabel.textContent = `Question ${state.current + 1} of ${QUESTIONS.length}`;
        progressValue.textContent = `${pct}%`;
        progressBar.style.width = `${pct}%`;

        answersWrap.innerHTML = "";
        question.options.forEach((optionData, optionIndex) => {
          const checked = state.answers[state.current] === optionIndex ? "checked" : "";
          const option = document.createElement("label");
          option.className =
            "group flex cursor-pointer items-start gap-3 rounded-xl border border-slate-200 bg-white/90 p-3 text-sm text-slate-700 transition-all duration-300 ease-out hover:-translate-y-0.5 hover:shadow-md focus-within:ring-2 focus-within:ring-makerSky focus-within:ring-offset-2 focus-within:ring-offset-white has-[:checked]:border-sky-300 has-[:checked]:bg-sky-50/70";
          option.innerHTML = `
            <input type="radio" name="q-${state.current}" value="${optionIndex}" class="mt-0.5 h-4 w-4 border-slate-300 text-sky-500 focus:ring-sky-200 focus-visible:ring-2 focus-visible:ring-makerSky focus-visible:ring-offset-2 focus-visible:ring-offset-white" ${checked} />
            <span>${optionData.text}</span>
          `;
          answersWrap.appendChild(option);
        });

        prevBtn.disabled = state.current === 0;
        nextBtn.disabled = false;
        nextBtn.textContent = state.current === QUESTIONS.length - 1 ? "Calculate Synergy" : "Next Prompt";
      }

      /**
       * Calculate compatibility and role, update result UI, and optionally keep reveal hidden.
       * @param {boolean} [holdReveal=false] - If true, do not switch views yet.
       * @returns {{ compatibility: number, role: string }}
       */
      function calculateResults(holdReveal = false) {
        const counts = { D: 0, I: 0, S: 0, C: 0 };
        state.answers.forEach((choice, idx) => {
          const option = QUESTIONS[idx] && QUESTIONS[idx].options[choice];
          if (!option) {
            return;
          }
          counts[option.trait] += 1;
        });

        const total = QUESTIONS.length;
        const userProfile = {
          D: counts.D / total,
          I: counts.I / total,
          S: counts.S / total,
          C: counts.C / total
        };

        const distance =
          Math.abs(userProfile.D - TYLER_PROFILE.D) +
          Math.abs(userProfile.I - TYLER_PROFILE.I) +
          Math.abs(userProfile.S - TYLER_PROFILE.S) +
          Math.abs(userProfile.C - TYLER_PROFILE.C);
        const compatibility = Math.max(0, Math.min(100, Math.round((1 - distance / 2) * 100)));

        const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);
        const topTrait = sorted[0][0];
        const secondTrait = sorted[1] ? sorted[1][0] : sorted[0][0];

        let role = "The Creative Enabler";
        let roleDetail = "You bring energy and adaptability, helping ideas move from rough concept to useful output.";

        if (topTrait === "D" && secondTrait === "C") {
          role = "The Lead Architect";
          roleDetail = "You align naturally with Tyler's mission-first planning style: decisive direction, tight systems, and high execution standards.";
        } else if (topTrait === "C") {
          role = "The Systems Strategist";
          roleDetail = "You reinforce quality and reliability, making the collaboration strong on risk control, structure, and delivery clarity.";
        } else if (topTrait === "D") {
          role = "The Momentum Driver";
          roleDetail = "You add pace and urgency, helping plans convert to action quickly while Tyler anchors system discipline.";
        } else if (topTrait === "I") {
          role = "The Creative Enabler";
          roleDetail = "You elevate morale, communication, and idea flow, balancing Tyler's technical intensity with social momentum.";
        } else if (topTrait === "S") {
          role = "The Stability Anchor";
          roleDetail = "You create consistency and trust, which strengthens long-range execution across maker projects and strategic goals.";
        }

        compatibilityEl.textContent = `${compatibility}%`;
        roleEl.textContent = role;
        roleDetailEl.textContent = roleDetail;
        const resultSummary = { compatibility, role };

        discBars.innerHTML = "";
        ["D", "I", "S", "C"].forEach((trait) => {
          const value = Math.round(userProfile[trait] * 100);
          const row = document.createElement("div");
          row.className = "space-y-1";
          row.innerHTML = `
            <div class="flex items-center justify-between text-xs font-semibold uppercase tracking-wide text-slate-500">
              <span>${TRAIT_LABELS[trait]}</span>
              <span>${value}%</span>
            </div>
            <div class="h-2.5 overflow-hidden rounded-full bg-slate-200/80">
              <div class="h-full ${TRAIT_COLORS[trait]} transition-all duration-500" style="width: ${value}%"></div>
            </div>
          `;
          discBars.appendChild(row);
        });

        if (holdReveal) {
          return resultSummary;
        }

        quizForm.classList.add("hidden");
        results.classList.remove("hidden");
        progressLabel.textContent = "Assessment Complete";
        progressValue.textContent = "100%";
        progressBar.style.width = "100%";
        return resultSummary;
      }

      /**
       * Animate from current question to a target question index.
       * @param {number} nextIndex - Next question index.
       * @returns {void}
       */
      function runQuestionTransition(nextIndex) {
        state.transitionBusy = true;
        prevBtn.disabled = true;
        nextBtn.disabled = true;
        quizForm.setAttribute("inert", "");

        if (prefersReducedMotion) {
          renderQuestion(nextIndex);
          quizForm.removeAttribute("inert");
          state.transitionBusy = false;
          focusCurrentQuestionOption();
          return;
        }

        questionCard.classList.add("opacity-0", "scale-95");

        window.setTimeout(() => {
          requestAnimationFrame(() => {
            renderQuestion(nextIndex);
          });
        }, SCAN_DURATION_MS / 2);

        window.setTimeout(() => {
          questionCard.classList.remove("opacity-0", "scale-95");
          quizForm.removeAttribute("inert");
          state.transitionBusy = false;
          focusCurrentQuestionOption();
        }, SCAN_DURATION_MS + 40);
      }

      /**
       * Animate final scan, compute results, send telemetry, then reveal summary.
       * @returns {void}
       */
      function runResultsTransition() {
        state.transitionBusy = true;
        prevBtn.disabled = true;
        nextBtn.disabled = true;
        quizForm.setAttribute("inert", "");

        const attemptCount = incrementQuizAttemptCount();
        let telemetryComplete = false;
        let syncDelayComplete = false;
        let finalized = false;

        function finalizeResultsTransition() {
          if (finalized || !telemetryComplete || !syncDelayComplete) {
            return;
          }

          finalized = true;
          syncStatus.classList.remove("opacity-100");
          quizForm.classList.add("hidden");
          syncStatus.classList.add("hidden");
          results.classList.remove("hidden");
          results.classList.add("opacity-0", "translate-y-2");
          requestAnimationFrame(() => {
            results.classList.remove("opacity-0", "translate-y-2");
            results.classList.add("opacity-100", "translate-y-0");
          });
          progressLabel.textContent = "Assessment Complete";
          progressValue.textContent = "100%";
          progressBar.style.width = "100%";
          state.transitionBusy = false;
          focusResultsSummary();
        }

        function startSyncAndTelemetry() {
          requestAnimationFrame(() => {
            const resultSummary = calculateResults(true);
            syncStatus.classList.remove("hidden");
            requestAnimationFrame(() => {
              syncStatus.classList.add("opacity-100");
            });
            transmitQuizTelemetry(resultSummary, attemptCount).finally(() => {
              telemetryComplete = true;
              finalizeResultsTransition();
            });
          });
        }

        window.setTimeout(() => {
          syncDelayComplete = true;
          finalizeResultsTransition();
        }, SCAN_DURATION_MS + RESULT_SYNC_MS);

        if (prefersReducedMotion) {
          startSyncAndTelemetry();
          return;
        }

        questionCard.classList.add("opacity-0", "scale-95");
        window.setTimeout(() => {
          startSyncAndTelemetry();
        }, SCAN_DURATION_MS / 2);
      }

      /**
       * Handle advancing the quiz by one step or triggering final results.
       * @returns {void}
       */
      function handleNextClick() {
        if (state.transitionBusy) {
          return;
        }

        const checked = document.querySelector(`input[name="q-${state.current}"]:checked`);
        if (!checked) {
          return;
        }

        state.answers[state.current] = Number(checked.value);
        if (state.current === QUESTIONS.length - 1) {
          runResultsTransition();
          return;
        }

        runQuestionTransition(state.current + 1);
      }

      /**
       * Handle moving to the previous question.
       * @returns {void}
       */
      function handlePreviousClick() {
        if (state.transitionBusy || state.current === 0) {
          return;
        }

        renderQuestion(state.current - 1);
        focusCurrentQuestionOption();
      }

      /**
       * Reset quiz state and UI for a full retake.
       * @returns {void}
       */
      function handleRetakeClick() {
        state.current = 0;
        state.answers = new Array(QUESTIONS.length).fill(null);
        state.transitionBusy = false;

        results.classList.add("hidden");
        results.classList.remove("opacity-100", "translate-y-0", "opacity-0", "translate-y-2");
        questionCard.classList.remove("opacity-0", "scale-95");
        syncStatus.classList.add("hidden");
        syncStatus.classList.remove("opacity-100");
        quizForm.classList.remove("hidden");
        quizForm.removeAttribute("inert");

        renderQuestion(0);
        focusCurrentQuestionOption();
      }

      /**
       * Attach event listeners for quiz controls.
       * @returns {void}
       */
      function bindEvents() {
        nextBtn.addEventListener("click", handleNextClick);
        prevBtn.addEventListener("click", handlePreviousClick);
        retakeBtn.addEventListener("click", handleRetakeClick);
      }

      /**
       * Boot the quiz experience after DOM readiness.
       * @returns {void}
       */
      function initializeQuiz() {
        if (!hasRequiredDom()) {
          return;
        }
        bindEvents();
        renderQuestion(0);
        requestAnimationFrame(() => {
          runSystemBoot();
        });
      }

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initializeQuiz, { once: true });
      } else {
        initializeQuiz();
      }
    })();
  </script>
</body>
</html>
